<%# <script>
  document.getElementById("cameraInput").addEventListener("change", function(event) {
    let file = event.target.files[0];
    if (file) {
      let reader = new FileReader();
      reader.onload = function(e) {
        extractTextFromImage(e.target.result);
      };
      reader.readAsDataURL(file);
    }
  });

  function extractTextFromImage(imageData) {
    fetch('<%= extract_company_path %>', { // This ensures correct POST route usage
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-CSRF-Token': document.querySelector("meta[name='csrf-token']").content
  },
  body: JSON.stringify({ image: imageData })
  })
    .then(response => response.json())
    .then(data => {
      if (data.company_name) {
        document.getElementById("extractedCompany").value = data.company_name;

        let companySelect = document.getElementById("companySelect");
        let existingOption = Array.from(companySelect.options).find(option => option.text === data.company_name);
        if (data.check_number) {
          document.getElementById("checkNumber").value = data.check_number;
        }

        if (existingOption) {
          companySelect.value = existingOption.value; // Select existing company
        } else {
          let newOption = new Option(data.company_name, "new");
          companySelect.appendChild(newOption);
          companySelect.value = "new"; // Select newly detected company
        }
      }
    });
  }
</script> %>